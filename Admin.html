<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Portal | Success Academy</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="Admin.css">
  <link rel="icon" href="image/WEB LOGO.jpg">
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>

  <div class="loader">
    <div class="spinner"></div>
  </div>

  <div class="admin-container">
    
    <aside class="sidebar" id="sidebar">
      <div class="logo">Admin Panel</div>
      <ul class="nav-links">
        <li><a href="#" class="active" data-target="dashboard">üìä Dashboard</a></li>
        <li><a href="#" data-target="students">üéì Manage Students</a></li>
        <li><a href="#" data-target="attendance">üìÖ Mark Attendance</a></li>
        <li><a href="#" data-target="upload-marks">üìà Upload Marks</a></li>
        <li><a href="#" data-target="leaderboard">üèÖ Leaderboard</a></li> 
        <li><a href="#" data-target="notices">üìå Post Notices</a></li>
        <li><a href="#" data-target="events">üìÖ Update Events</a></li>
        <li><a href="#" data-target="messages">üì© Messages</a></li>
        <li><a href="#" data-target="promotion">üöÄ Year-End Promotion</a></li>
      </ul>
      <button class="logout-btn" onclick="confirmLogout()">Logout</button>
    </aside>

    <main class="main-content">
      
      <header class="admin-header">
        <div class="hamburger" id="hamburger">
          <span></span><span></span><span></span>
        </div>
        <h2>Welcome, Director</h2>
        <div class="admin-profile">
          <img src="image/WEB LOGO.jpg" alt="Admin Profile">
        </div>
      </header>

      <section id="dashboard" class="content-section active">
        <h3 class="section-title">Overview</h3>
        
        <div class="stats-grid">
          <div class="stat-card">
            <h4>Total Students</h4>
            <p id="totalStudentsCount">0</p>
          </div>
          <div class="stat-card">
            <h4>Pending Approvals</h4>
            <p id="pendingCount">0</p>
          </div>
        </div>

           <h3 class="section-title" style="margin-top:40px;">üé´ Registration QR Access</h3>

<div class="glass-panel" style="max-width:400px;">
  <button class="glass-btn" onclick="generateQR()">Generate Registration QR</button>
  <div id="qrContainer" style="margin-top:20px; text-align:center;"></div>
</div>

        <h3 class="section-title" style="margin-top: 40px;">Approve Registrations</h3>
        <p style="color: #ccc; font-size: 14px; margin-bottom: 15px;">Clicking approve will automatically generate and assign a Registration Number and Password.</p>
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Standard</th>
                <th>Course Details</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="pendingRegistrations">
              <tr>
                <td colspan="4" style="text-align: center;">Loading pending registrations...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <h3 class="section-title" style="margin-top: 50px;">New Admission Applications</h3>
<p style="color: #ccc; font-size: 14px; margin-bottom: 15px;">Students who filled out the "Apply for Admission" form on the homepage. Click 'Enquiry Done' once you have contacted them.</p>

<div class="table-container">
  <table class="admin-table">
    <thead>
      <tr>
        <th>Applicant Name</th>
        <th>Contact Details</th>
        <th>Academic Request</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="admissionApplicationsBody">
      <tr>
        <td colspan="4" style="text-align: center;">Loading applications...</td>
      </tr>
    </tbody>
  </table>
</div>
      </section>

      <section id="students" class="content-section">
        <h3 class="section-title">Student Database</h3>
       <div class="search-bar" style="display: flex; gap: 10px; align-items: center;">
          <select id="filterStatus" class="admin-input" style="width: auto; min-width: 160px; margin-bottom: 0;" onchange="searchStudent()">
            <option value="Active">üü¢ Active Students</option>
            <option value="Graduated">üéì Graduated</option>
          </select>
          
          <input type="text" id="searchInput" placeholder="Search by Name or Reg No..." class="admin-input" style="margin-bottom: 0;" onkeypress="handleSearchEnter(event)">
          <button class="glass-btn" style="width: auto; padding: 10px 20px; margin-top: 0;" onclick="searchStudent()">Search</button>
        </div>

        <div id="searchResults" class="table-container" style="margin-top: 20px;">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Reg No</th>
                <th>Name</th>
                <th>Standard</th>
                <th>Course</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="searchResultsBody">
              </tbody>
          </table>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
          
          <div class="glass-panel" style="padding: 20px; border-radius: 12px;">
            <h4 style="margin-bottom: 15px; color: #00ff88;">üìÑ Download Whole Datasheet</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <select id="exportWholeStd" class="admin-input" style="flex: 1; min-width: 120px; margin-bottom: 0;">
                <option value="" disabled selected>Standard</option>
                <option value="11th">11th</option>
                <option value="12th">12th</option>
              </select>
              <select id="exportWholeType" class="admin-input" style="flex: 1; min-width: 120px; margin-bottom: 0;">
                <option value="" disabled selected>Type</option>
                <option value="All">All</option>
                <option value="Regular">Regular</option>
                <option value="Regular+Academy">Regular + Academy</option>
                <option value="Crash Course">Crash Course</option>
              </select>
            </div>
            <button class="glass-btn" style="margin-top: 15px;" onclick="downloadWholeDatasheet()">Download Excel</button>
          </div>

          <div class="glass-panel" style="padding: 20px; border-radius: 12px;">
            <h4 style="margin-bottom: 15px; color: #ffcc00;">üìä Download Marks Template</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <select id="exportMarksStd" class="admin-input" style="flex: 1; min-width: 120px; margin-bottom: 0;">
                <option value="" disabled selected>Standard</option>
                <option value="11th">11th</option>
                <option value="12th">12th</option>
              </select>
              <select id="exportMarksType" class="admin-input" style="flex: 1; min-width: 120px; margin-bottom: 0;">
                <option value="" disabled selected>Type</option>
                <option value="All">All</option>
                <option value="Regular">Regular</option>
                <option value="Regular+Academy">Regular + Academy</option>
                <option value="Crash Course">Crash Course</option>
              </select>
            </div>
            <button class="glass-btn" style="margin-top: 15px;" onclick="downloadMarksTemplate()">Download Template</button>
          </div>
        </div>
      </section>
      

      <section id="attendance" class="content-section">
        <h3 class="section-title">Mark Daily Attendance</h3>

        <div class="glass-panel" style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; padding: 20px; border-radius: 12px;">
          <input type="date" id="attDate" class="admin-input" style="max-width: 200px; margin-bottom: 0;" required>
          
          <select id="attStandard" class="admin-input" style="max-width: 200px; margin-bottom: 0;">
            <option value="">Select Standard</option>
            <option value="11th">11th Standard</option>
            <option value="12th">12th Standard</option>
          </select>

          <select id="attType" class="admin-input" style="max-width: 200px; margin-bottom: 0;">
            <option value="">Select Type</option>
            <option value="All">All Students</option>
            <option value="Regular+Academy">Regular + Academy</option>
            <option value="Crash Course">Crash Course</option>
          </select>

          <button class="glass-btn" onclick="loadAttendanceList()" style="width: auto; padding: 10px 20px; margin-top: 0;">Load Students</button>
        </div>

        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Reg No</th>
                <th>Student Name</th>
                <th>Batch Type</th>
                <th style="text-align: center;">Status (P/A)</th>
              </tr>
            </thead>
            <tbody id="attendanceListBody">
              <tr>
                <td colspan="4" style="text-align:center; color:#ccc; padding: 20px;">
                  Select Date, Standard and Type, then click 'Load Students'
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div style="text-align: right; margin-top: 20px;">
          <button class="glass-btn" onclick="submitAttendance()" style="background: rgba(0, 255, 136, 0.2); color: #00ff88; width: auto; padding: 10px 30px; border: 1px solid #00ff88;">
            Submit Attendance ‚úÖ
          </button>
        </div>
      </section>

      <section id="upload-marks" class="content-section">
        <h3 class="section-title">Upload Exam Marks</h3>
        <p style="color: #ccc; font-size: 14px; margin-bottom: 20px;">Upload an Excel (.xlsx) or CSV file. The system will automatically parse the marks and generate personalized sticky notices.</p>
        
        <div class="form-panel" style="max-width: 800px;">
          <form onsubmit="uploadExcelMarks(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
              <div>
                <label>Standard</label>
                <select id="marksStd" class="admin-input" required>
                  <option value="" disabled selected>Select Std...</option>
                  <option value="11th">11th</option>
                  <option value="12th">12th</option>
                </select>
              </div>
              <div>
                <label>Exam Title</label>
                <input type="text" id="marksTitle" class="admin-input" placeholder="e.g., Weekly Mock" required>
              </div>
              <div>
                <label>Exam Date</label>
                <input type="date" id="marksDate" class="admin-input" required>
              </div>
            </div>

            <label>Subject</label>
            <select id="marksSub" class="admin-input" required>
              <option value="" disabled selected>Select Subject...</option>
              <option value="Physics">Physics</option>
              <option value="Chemistry">Chemistry</option>
              <option value="Mathematics">Mathematics</option>
              <option value="Biology">Biology</option>
              <option value="Full Syllabus (PCM)">Full Syllabus (PCM)</option>
              <option value="Full Syllabus (PCB)">Full Syllabus (PCB)</option>
            </select>

            <label>Upload Excel / CSV File</label>
            <div class="upload-box" onclick="document.getElementById('marksFile').click()">
              <div style="font-size: 40px; margin-bottom: 10px;">üìä</div>
              <p style="color: #ffcc00; font-weight: 600; font-size: 18px;">Click to Browse or Drag File Here</p>
              <p style="color: #aaa; font-size: 12px; margin-top: 5px;" id="fileNameDisplay">Only .xlsx or .csv allowed</p>
              <input type="file" id="marksFile" accept=".csv, .xlsx" style="display: none;" onchange="updateFileName(this)" required>
            </div>

            <button type="submit" id="marksSubmitBtn" class="glass-btn" style="margin-top: 15px;">Upload & Generate Notices</button>
          </form>
        </div>
      </section>

      <section id="leaderboard" class="content-section">
    <h2 class="section-title">Weekly Leaderboard</h2>
    
    <div style="margin-bottom: 20px;">
        <label for="adminExamFilter" style="color: #ccc;">Filter by Exam:</label>
        <select id="adminExamFilter" class="glass-input" style="width: 200px; display: inline-block; margin-left: 10px;" onchange="loadAdminLeaderboard()">
            <option value="All">All Exams</option>
            <option value="JEE">JEE</option>
            <option value="NEET">NEET</option>
            <option value="MHT-CET">MHT-CET</option>
        </select>
    </div>

    <div class="table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Reg No</th>
                    <th>Student Name</th>
                    <th>Exam Target</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="adminLeaderboardBody">
                <tr><td colspan="5">Loading leaderboard...</td></tr>
            </tbody>
        </table>
    </div>
</section>
      <section id="notices" class="content-section">
        <h3 class="section-title">Publish a New Notice</h3>
        <div class="form-panel">
          <form onsubmit="publishNotice(event)">
            <label>Notice Type</label>
            <select id="noticeType" class="admin-input" required>
              <option value="Fee">Fee Related</option>
              <option value="Remarks">Personal Remarks</option>
            </select>

            <label>Target Student Reg No (Leave blank for all students)</label>
            <input type="text" id="noticeTarget" class="admin-input" placeholder="e.g., SA2024001">

            <label>Notice Title</label>
            <input type="text" id="noticeTitle" class="admin-input" placeholder="e.g., Installment Due Reminder" required>

            <label>Notice Content</label>
            <textarea id="noticeContent" class="admin-input" rows="4" placeholder="Type the notice details here..." required></textarea>

            <button type="submit" class="glass-btn">Publish Notice</button>
          </form>
        </div>
      </section>

      <section id="events" class="content-section">
        <h3 class="section-title">Add Upcoming Event</h3>
        <div class="form-panel">
          <form onsubmit="addEvent(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
              <div>
                <label>Target Standard</label>
                <select id="eventStd" class="admin-input" required>
                  <option value="Both">Both (11th & 12th)</option>
                  <option value="11th">11th Standard</option>
                  <option value="12th">12th Standard</option>
                </select>
              </div>
              <div>
                <label>Target Batch</label>
                <select id="eventType" class="admin-input" required>
                  <option value="All">All Batches</option>
                  <option value="Regular">Regular</option>
                  <option value="Regular+Academy">Regular + Academy</option>
                  <option value="Crash Course">Crash Course</option>
                </select>
              </div>
              <div>
                <label>Event Date</label>
                <input type="date" id="eventDate" class="admin-input" required>
              </div>
            </div>

            <label>Event Title</label>
            <input type="text" id="eventTitle" class="admin-input" required>

            <label>Description</label>
            <textarea id="eventDesc" class="admin-input" rows="3" required></textarea>

            <button type="submit" class="glass-btn">Add to Timeline</button>
          </form>
        </div>
      </section>

      <section id="messages" class="content-section">
        <h3 class="section-title">Student Dashboard Messages</h3>
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>  
                <th>Student</th>
                <th>Standard & Type</th>
                <th>Message</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="messagesBody">
              <tr>
                <td colspan="5" style="text-align: center;">Loading messages...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <h3 class="section-title" style="margin-top: 40px;">Homepage Inquiries</h3>
        <p style="color: #ccc; font-size: 14px; margin-bottom: 15px;">Public contact form submissions. Replying will send them an Email.</p>
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Visitor Details</th>
                <th>Subject</th>
                <th>Message Snippet</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="publicInquiriesBody">
              <tr><td colspan="5" style="text-align: center;">Loading inquiries...</td></tr>
            </tbody>
          </table>
        </div>
      </section>
      <section id="promotion" class="content-section">
        <h3 class="section-title">Year-End Bulk Promotion</h3>
        <p style="color: #ccc; font-size: 14px; margin-bottom: 20px;">Use this tool at the end of the academic year. <span style="color:#ff4d4d; font-weight:bold;">WARNING:</span> These actions instantly affect all students in the selected standard.</p>
        
        <div class="glass-panel" style="max-width: 650px; padding: 30px; border-radius: 12px; border: 1px solid rgba(255, 77, 77, 0.3);">
          <label style="color: #ffcc00; font-weight: 600; font-size: 16px;">Select Target Standard</label>
          <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
            
            <select id="bulkPromoteStd" class="admin-input" style="flex: 1; min-width: 250px; margin-bottom: 0;">
              <option value="11th">11th Standard (Promote to 12th)</option>
              <option value="12th">12th Standard (Graduate / Revoke Access)</option>
            </select>

            <button class="glass-btn" style="background: rgba(255, 77, 77, 0.15); color: #ff4d4d; border: 1px solid #ff4d4d; margin-top: 0; width: auto; padding: 10px 30px;" onclick="executeBulkPromotion()">Execute Promotion ‚ö†Ô∏è</button>
            
          </div>
        </div>
      </section>
    </main>
  </div>


  <div class="admin-modal" id="studentProfileModal">
    <div class="profile-box">
      <button class="close-btn" onclick="closeProfileModal()">&times;</button>
      
      <div class="profile-header">
        <div class="profile-avatar">üéì</div>
        <div>
          <h2>Edit Student</h2>
          <p id="modalRegNoDisplay" style="color: #ffcc00; font-weight: 600;">SA0000000</p>
        </div>
      </div>

      <input type="hidden" id="modalStudentId">
      
      <div class="profile-details-grid" style="margin-top: 20px;">
        <div class="detail-group">
          <label>Full Name</label>
          <input type="text" id="modalName" class="admin-input" style="padding: 5px;">
        </div>
        <div class="detail-group">
          <label>Email Address</label>
          <input type="email" id="modalEmail" class="admin-input" style="padding: 5px;">
        </div>  
        <div class="detail-group">
          <label>Phone Number</label>
          <input type="text" id="modalPhone" class="admin-input" style="padding: 5px;">
        </div>
        <div class="detail-group">
          <label>Parent Phone</label>
          <input type="text" id="modalParentPhone" class="admin-input" style="padding: 5px;">
        </div>
        <div class="detail-group">
          <label>School Name</label>
          <input type="text" id="modalSchool" class="admin-input" style="padding: 5px;">
        </div>
        <div class="detail-group">
          <label>Standard</label>
          <select id="modalStd" class="admin-input" style="padding: 5px;">
            <option value="11th">11th</option>
            <option value="12th">12th</option>
          </select>
        </div>
        <div class="detail-group">
          <label>Type</label>
          <select id="modalType" class="admin-input" style="padding: 5px;">
            <option value="Regular">Regular</option>
            <option value="Regular+Academy">Regular + Academy</option>
            <option value="Crash Course">Crash Course</option>
          </select>
        </div>
        <div class="detail-group">
          <label>Group</label>
          <input type="text" id="modalGroup" class="admin-input" style="padding: 5px;">
        </div>
        
        <div class="detail-group" style="grid-column: span 2;">
          <label>Target Exam (Select one or more)</label>
          <div style="display: flex; gap: 15px; margin-top: 5px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
            <label style="cursor: pointer; display: flex; align-items: center; gap: 5px; color: #fff;">
              <input type="checkbox" class="edit-exam-cb" value="MHT-CET"> MHT-CET
            </label>
            <label style="cursor: pointer; display: flex; align-items: center; gap: 5px; color: #fff;">
              <input type="checkbox" class="edit-exam-cb" value="JEE"> JEE
            </label>
            <label style="cursor: pointer; display: flex; align-items: center; gap: 5px; color: #fff;">
              <input type="checkbox" class="edit-exam-cb" value="NEET"> NEET
            </label>
          </div>
        </div>
      </div> <div class="profile-actions" style="margin-top: 20px; display: flex; gap: 10px;">
        <button class="glass-btn edit-btn" onclick="updateStudent()">Save Updates</button>
        <button class="glass-btn suspend-btn" onclick="deleteStudent()">Permanent Delete</button>
      </div>

    </div> </div> <div class="admin-modal" id="replyModal">
    <div class="profile-box" style="max-width: 500px;">
      <button class="close-btn" onclick="closeReplyModal()">&times;</button>
      
      <div class="profile-header">
        <div class="profile-avatar">‚úâÔ∏è</div>
        <div>
          <h2 id="replyModalTitle">Reply to Message</h2>
          <p id="replyModalSubtitle" style="color: #ccc; font-size: 14px;">Replying to User</p>
        </div>
      </div>

      <input type="hidden" id="replyTargetType">
      <input type="hidden" id="replyTargetId">
      <input type="hidden" id="replyTargetEmail">

      <div style="margin-top: 20px;">
        <label>Your Reply Message:</label>
        <textarea id="replyMessage" class="admin-input" rows="6" placeholder="Type your professional reply here..." required style="padding: 10px; width: 100%;"></textarea>
      </div>

      <div class="profile-actions" style="margin-top: 15px;">
        <button class="glass-btn" id="sendReplyBtn" onclick="submitCustomReply()">Send Reply üöÄ</button>
      </div>

    </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="Admin.js"></script>
</body>
</html>